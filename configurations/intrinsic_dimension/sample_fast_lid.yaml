intrinsic_dimension_estimator:
  method: dimensions.flow_fast_lid.FastFlowLID
  method_args:
    flow_model_class: model_zoo.density_estimator.flow.NormalizingFlow
    flow_model_args:
      # Data transform args (they are here because they might influence log_prob)
      flatten: False
      data_shape: [3]

      denoising_sigma: null
      dequantize: False
      scale_data: False
      whitening_transform: False
      logit_transform: False
      clamp_samples: False

      # Base distribution arguments (in this work the base is always Gaussian)
      base_distribution:
        class_path: nflows.distributions.StandardNormal
        init_args:
          shape: [3]
      

      transform:
      - repeat_n: 3
        content:
          - class_path: nflows.transforms.normalization.ActNorm
            init_args:
              features: 3
          - class_path: model_zoo.density_estimator.flow.ConfigurableCouplingTransform
            init_args: 
              coupling_transform_cls: nflows.transforms.PiecewiseRationalQuadraticCouplingTransform
              net:
                class_path: nflows.nn.nets.resnet.ResidualNet
                init_args:
                  hidden_features: 128
                  num_blocks: 3
              mask:
                dim: 3
                flip: True
              tails: linear
              num_bins: 2
              tail_bound: 1.0
          
          - class_path: nflows.transforms.normalization.ActNorm
            init_args:
              features: 3
          - class_path: model_zoo.density_estimator.flow.ConfigurableCouplingTransform
            init_args: 
              coupling_transform_cls: nflows.transforms.PiecewiseRationalQuadraticCouplingTransform
              net:
                class_path: nflows.nn.nets.resnet.ResidualNet
                init_args:
                  hidden_features: 128
                  num_blocks: 3
              mask:
                dim: 3
                flip: False
              tails: linear
              num_bins: 2
              tail_bound: 1.0
    checkpoint_tag: best_valid
    flow_model_trainer_args:
      trainer_cls: model_zoo.trainers.single_trainer.SingleTrainer
      optimizer:
        class_path: torch.optim.AdamW
        init_args:
          lr: 0.001
      evaluator:
        valid_metrics: [loss]
        test_metrics: [loss]
      sample_freq: null # logs the samples after every two epochs
      max_epochs: 220
      early_stopping_metric: loss
      max_bad_valid_epochs: 30
      max_grad_norm: 1.0
      only_test: False
      progress_bar: True

    verbose: 1
    r: -20

writer:
  logdir: runs
  make_subdir: False
  explicit_subdir: my_fast_lid_sphere
  tag_group: flow
  type: wandb
  entity: dgm-l6
  project: training-dgms
  name: sphere_toy_example
  project: intrinsic-dimension-single-runs

data:
  dataset: sphere
  make_valid_loader: True
  train_batch_size: 128
  valid_batch_size: 128
  test_batch_size: 128

